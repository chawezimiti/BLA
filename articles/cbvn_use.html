<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BLA">
<title>Use of censored bivariate normal model function for yield gap analysis • BLA</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use of censored bivariate normal model function for yield gap analysis">
<meta property="og:description" content="BLA">
<meta property="og:image" content="https://chawezimiti.github.io/BLA/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BLA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/BLA.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/cbvn_use.html">Use of censored bivariate normal model function for yield gap analysis</a>
    <a class="dropdown-item" href="../articles/introducton_to_BLA.html">Introduction to boundary line analysis</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/chawezimiti/BLA/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Use of censored bivariate normal model function for yield gap analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/chawezimiti/BLA/blob/HEAD/vignettes/cbvn_use.Rmd" class="external-link"><code>vignettes/cbvn_use.Rmd</code></a></small>
      <div class="d-none name"><code>cbvn_use.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The censored bivariate normal model (Lark and Milne, 2016) is a
statistical method of fitting the boundary line to data. It fits the
boundary line using the maximum likelihood approach on a censored
bivariate distribution. This removes the subjectivity mostly associated
with the other boundary line fitting methods ( BOLIDES, Binning and
quantile regression) of selecting boundary points to which the boundary
line is fitted. It also gives evidence for presence of boundary in a
data set. This method has been previously used to fit boundary lines to
data on nitrous oxide emission as a function of soil moisture (Lark and
Milne, 2016) and, Wheat yield as a function of Nutrient concentration
(Lark <em>et al.</em> 2020). An <code>R</code> package,
<code>BLA</code>, contains exploratory and boundary fitting functions
that can be used in the process of fitting a boundary line to data using
censored bivariate normal model. This vignette gives a step by step
process for fitting the boundary line and subsequent post-hoc analysis.
In this demonstration, the data set soil will be used and boundary line
analysis will be carried out on soil P and pH.</p>
</div>
<div class="section level2">
<h2 id="installing-dependent-packages">Installing dependent packages<a class="anchor" aria-label="anchor" href="#installing-dependent-packages"></a>
</h2>
<p>The <code>BLA</code> package requires that the packages
<code>MASS,</code> <code>aplpack</code> and <code>mvtnorm</code> are
installed in <code>R</code>. You can install these packages using the
following code</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># package names</span></span>
<span><span class="va">packages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MASS"</span>, <span class="st">"mvtnorm"</span>, <span class="st">"aplpack"</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># install packages</span></span>
<span><span class="va">installed_packages</span> <span class="op">&lt;-</span> <span class="va">packages</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">installed_packages</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">packages</span><span class="op">[</span><span class="op">!</span><span class="va">installed_packages</span><span class="op">]</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>The <code>BLA</code> package can then be loaded</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://chawezimiti.github.io/BLA/">BLA</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: no DISPLAY variable so Tk is not available</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.uni-bielefeld.de/fakultaeten/wirtschaftswissenschaften/fakultaet/lehrende-ehemalige/pwolf/wolf_aplpack/index.xml" class="external-link">aplpack</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="yield-gap-analysis-using-boundary-lines">Yield gap analysis using boundary lines<a class="anchor" aria-label="anchor" href="#yield-gap-analysis-using-boundary-lines"></a>
</h2>
<p>The data that is going to be used for this is called the
<code>soil</code>which is part of the <code>BLA</code> package. It
contains measures of wheat yield on farms from different parts of the UK
and its associated soil properties pH and phosphorus. The process of
yield gap analysis involves two step that include (1) fitting the
boundary line and (2) determining the most limiting factor. We will
first fit the boundary line to soil P and then to pH after which the
most limiting factor will be determined.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"soil"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="soil-p-boundary-line-fitting">Soil P boundary line fitting<a class="anchor" aria-label="anchor" href="#soil-p-boundary-line-fitting"></a>
</h3>
<div class="section level4">
<h4 id="data-exploration">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration"></a>
</h4>
<p>Exploratory analysis is an essential initial step in fitting a
boundary line to data. This step ensures that the assumptions for the
censored bivariate normal model are met. Three exploratory procedures
are performed on the data which include (1) Testing for normality of
variables, (2) Removal of outliers, and (3) Testing for evidence of
boundary in the data.</p>
<p>1. Testing for normality of independent and dependent variable</p>
<p>Boundary line model fitting using <code><a href="../reference/cbvn.html">cbvn()</a></code> requires that
the independent (<code>x</code>) and dependent (<code>y</code>)
variables are normally distributed. The <code><a href="../reference/summa.html">summa()</a></code> function
gives indices of the distribution of a variable. A variable is assumed
to be normally distributed if the skewness index is between -1 and 1.
The <code><a href="../reference/summaplot.html">summaplot()</a></code> function gives a visual description of the
distribution.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">&lt;-</span><span class="va">soil</span><span class="op">$</span><span class="va">P</span></span>
<span><span class="va">y</span><span class="op">&lt;-</span><span class="va">soil</span><span class="op">$</span><span class="va">yield</span></span>
<span></span>
<span><span class="co">#Distribution of the x variable</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summa.html">summa</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># Gives indices for skewness. Normal distribution range of -1 to 1. If not normally distributed,a transformation is required </span></span>
<span><span class="co">#&gt;         Mean Median Quartile.1 Quartile.3 Variance       SD Skewness</span></span>
<span><span class="co">#&gt; [1,] 25.9647     22         16         32 207.0066 14.38772 1.840844</span></span>
<span><span class="co">#&gt;      Octile skewness Kurtosis No. outliers</span></span>
<span><span class="co">#&gt; [1,]       0.3571429 5.765138           43</span></span>
<span><span class="fu"><a href="../reference/summaplot.html">summaplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># histogram and qqplot for distribution of x</span></span></code></pre></div>
<p><img src="cbvn_use_files/figure-html/unnamed-chunk-4-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/summa.html">summa</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt;          Mean   Median Quartile.1 Quartile.3  Variance        SD  Skewness</span></span>
<span><span class="co">#&gt; [1,] 3.126361 3.091042   2.772589   3.465736 0.2556936 0.5056615 0.1297406</span></span>
<span><span class="co">#&gt;      Octile skewness    Kurtosis No. outliers</span></span>
<span><span class="co">#&gt; [1,]      0.08395839 -0.05372586            0</span></span>
<span><span class="fu"><a href="../reference/summaplot.html">summaplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="cbvn_use_files/figure-html/unnamed-chunk-4-2.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Distribution of the y variable</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summa.html">summa</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="co"># Gives indices for skewness. Normal distribution range of -1 to 1. If not normally distributed,a transformation is required </span></span>
<span><span class="co">#&gt;          Mean  Median Quartile.1 Quartile.3 Variance       SD   Skewness</span></span>
<span><span class="co">#&gt; [1,] 9.254813 9.36468   8.203703   10.39477 3.456026 1.859039 -0.4819805</span></span>
<span><span class="co">#&gt;      Octile skewness Kurtosis No. outliers</span></span>
<span><span class="co">#&gt; [1,]     -0.05793291 1.292635            7</span></span>
<span><span class="fu"><a href="../reference/summaplot.html">summaplot</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="co"># histogram and qqplot for distribution of y</span></span></code></pre></div>
<p><img src="cbvn_use_files/figure-html/unnamed-chunk-4-3.png" width="384" style="display: block; margin: auto;"></p>
<p>2. Removal of outliers</p>
<p>Boundary line analysis is sensitive to outlying values and hence it
is required that they are identified and removed. A bag plot (a
bivariate box plot) is used to identify outliers. The bag plot has four
main components, (1) a depth median (equivalent to the median in a box
plot) which is represents the centre of the data set, (2) The bag which
contains 50% of the data points (eqiuavalent to the interquartile
range), (3) a ‘fence’ that separates probable outliers, (4) a loop which
contains points outside the bag but are not outliers.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># since we requred a transformation</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> </span>
<span><span class="va">bag</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/aplpack/man/bagplot.html" class="external-link">bagplot</a></span><span class="op">(</span><span class="va">df</span>,show.whiskers <span class="op">=</span> <span class="cn">FALSE</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bag"</span>,<span class="st">"loop"</span>,<span class="st">"outliers"</span>, <span class="st">"d.median"</span><span class="op">)</span>, </span>
<span>           pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>,<span class="fl">15</span>,<span class="fl">16</span>,<span class="fl">8</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"lightblue"</span>,<span class="st">"red"</span>,<span class="st">"red"</span><span class="op">)</span>,cex<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="cbvn_use_files/figure-html/unnamed-chunk-5-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Combine data points from "bag" and within the loop</span></span>
<span></span>
<span><span class="va">dat</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">bag</span><span class="op">$</span><span class="va">pxy.bag</span>,<span class="va">bag</span><span class="op">$</span><span class="va">pxy.outer</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Output is a matrix, we can pull out x and y variables for next stage </span></span>
<span></span>
<span><span class="va">x</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> </span>
<span><span class="va">y</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p>3. Testing data for presence of boundary</p>
<p>It is important to note that not all data are suitable for boundary
line analysis. Data used in boundary line analysis should exhibit some
form of boundary on its edges (to satisfy the assumption that this is
response when other factors are not limiting). If a boundary exists in a
data set, it is expected that points at the upper edges of the data
cloud will be close to each other compared to a bivariate normally
distributed data for which data points at the upper edges are only due
to random error. A boundary can be assumed in a data set if there is
evidence of clustering at the upper edges. The
<code><a href="../reference/expl_boundary.html">expl_boundary()</a></code> function, which is based on the convex
hull, can be used to access presence of boundary (Milne et al, 2006).
This function checks probability of the observed clustering if it came
from a bivariate normal distribution (p-value).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/expl_boundary.html">expl_boundary</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="co"># may take a few minutes to complete</span></span></code></pre></div>
<p>From the results, the probability (p-value) of the having points
close to each other as in our data if it came from a bivariate normally
distributed data is less than 5%. Therefore, there is evidence of
bounding effects in the data in the right and left sections of the data.
Note that, in the plot, the data is split into right and left sections
to get more information on the clustering nature of points.</p>
</div>
<div class="section level4">
<h4 id="fitting-the-boundary-line-to-data">Fitting the boundary line to data<a class="anchor" aria-label="anchor" href="#fitting-the-boundary-line-to-data"></a>
</h4>
<p>From the exploratory tests, they indicated that the data provides
evidence of boundary existence, outliers have been identified and
removed, and the variables <em><code>x</code></em> and
<em><code>y</code></em> are normally distributed. We therefore, proceed
to fit a boundary line model to the data set using the censored
bivariate normal model. The function <em><code><a href="../reference/cbvn.html">cbvn()</a></code></em> fits
the boundary line to the data. For more information about the arguments
of this function, check</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">cbvn</span></span></code></pre></div>
<p>Argument values for the function <em><code><a href="../reference/cbvn.html">cbvn()</a></code></em> need to
be set . Firstly, create a data-frame containing <em>x</em> and
<em>y,</em> called <code>vals</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vals</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="co">#This is an input dataframe containing the variables</span></span></code></pre></div>
<p>Secondly, the <em><code><a href="../reference/cbvn.html">cbvn()</a></code></em> requires initial starting
values, <em><code>theta</code></em>, which are parameters of the
boundary line (the censor) and the bivariate normal distribution.
Starting values of the boundary line depend on the model that one wishes
to fit to the data (see options in <em><code><a href="../reference/cbvn.html">?cbvn</a></code></em>) . In
this case, we shall fit a linear+Plateau model (lp) and hence the
parameters are the plateau value and the intercept and slope of the
linear component. The boundary line start values can be obtained using
the function <em><code><a href="../reference/startValues.html">startValues()</a></code>.</em> For more information
on the <em><code><a href="../reference/startValues.html">startValues()</a></code></em> function run the code
<em><code><a href="../reference/startValues.html">?startValues</a></code></em>. With a scatter plot of <em>y</em>
against <em>x</em> active in the plot window in <code>R</code>, run the
function <em><code>start.values("lp")</code></em>, then click on the
plot, the point you expect to be the lowest and the largest response of
a linear model at the boundary. Note that starting values for other
models can be determined by changing the model name from “lp” to the
desired models (see <em><code><a href="../reference/startValues.html">?startValues</a></code></em> help file).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/startValues.html">startValues</a></span><span class="op">(</span><span class="st">"lp"</span><span class="op">)</span> </span></code></pre></div>
<p>Next, determine the parameters of the bivariate normal distribution
which include the means of the <em>x</em> and <em>y</em> variables,
standard deviation of the <em>x</em> and <em>y</em> variables, and the
correlation of <em>x</em> and <em>y</em>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 3.125969</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 9.28862</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 0.5005755</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 1.728996</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0346758</span></span>
<span></span>
<span><span class="co">#The parameters of the boundary line and the data can be combined in a #vector theta in the order </span></span>
<span><span class="co">#theta&lt;-c(intercept, slope, max response, mean(x), mean(y), sd(x), sd(y), cor(x,y))</span></span>
<span></span>
<span><span class="va">theta</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">13.6</span>,<span class="fl">3</span>,<span class="fl">9</span>,<span class="fl">0.5</span>,<span class="fl">1.9</span>,<span class="fl">0.05</span><span class="op">)</span> </span></code></pre></div>
<p>Another important argument is the standard deviation of the
measurement error, <em><code>sigh</code></em>. This value can be
obtained from standard deviation of repeated measurements of the sample
if this data is available. However, in cases when it is not available,
it can be estimated using different options. One option of estimation is
to use a variogram if the location data (<em>x y</em> co-ordinate) is
available. In that case, nugget variance which is the unexplained short
distance variations can be taken as an estimate of the measurement
error. If this is not possible, a profiling procedure can be done. This
is done by fitting a proposed model using a varied number of
<em><code>sign</code></em> values while keeping the rest of the model
parameters constant. The log-likelihood values of the model for each
<em>sign</em> are determined and the value that maximizes the likelihood
can be selected from the log-likelihood profile. This can be implemented
using the <em><code><a href="../reference/ble_profile.html">ble_profile()</a></code></em> function. For more
information on this function run</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">ble_profile</span></span></code></pre></div>
<p>The possible <code>sigh</code> values can be set to 0.5, 0.7 and 0.8
and we can check the likelihood profile.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sigh</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ble_profile.html">ble_profile</a></span><span class="op">(</span><span class="va">vals</span>,<span class="va">theta</span>,<span class="va">sigh</span>,model <span class="op">=</span> <span class="st">"lp"</span><span class="op">)</span> <span class="co"># may take a few minutes to run for large datasets</span></span></code></pre></div>
<p>From the likelihood profile, the <code>sigh</code> that maximizes the
likelihood is around 0.65. We can use this for the value of
<em><code>sigh</code></em>. Now that all the arguments required for
<code><a href="../reference/cbvn.html">cbvn()</a></code> function are set, the boundary line can be
fitted</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model1</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/cbvn.html">cbvn</a></span><span class="op">(</span><span class="va">vals</span>,<span class="va">theta</span>,sigh<span class="op">=</span><span class="fl">0.7</span>,model <span class="op">=</span> <span class="st">"lp"</span>, xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"P /log ppm"</span><span class="op">)</span>, ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Yield /t ha"</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">}</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">16</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: This function may take a few minutes to run for large datasets.</span></span></code></pre></div>
<p><img src="cbvn_use_files/figure-html/unnamed-chunk-13-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model1</span></span>
<span><span class="co">#&gt; $Model</span></span>
<span><span class="co">#&gt; [1] "lp"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Equation</span></span>
<span><span class="co">#&gt; [1] y = min (β₁ + β₂x, β₀)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Parameters</span></span>
<span><span class="co">#&gt;          Estimate Standard error</span></span>
<span><span class="co">#&gt; β₁     4.06696828    1.066777243</span></span>
<span><span class="co">#&gt; β₂     3.33394002    0.485261997</span></span>
<span><span class="co">#&gt; β₀    13.11507868    0.118534298</span></span>
<span><span class="co">#&gt; mux    3.12596856    0.006451139</span></span>
<span><span class="co">#&gt; muy    9.29877789    0.022675263</span></span>
<span><span class="co">#&gt; sdx    0.50053521    0.004561613</span></span>
<span><span class="co">#&gt; sdy    1.60137488    0.018125430</span></span>
<span><span class="co">#&gt; rcorr  0.03013864    0.014331202</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $AIC</span></span>
<span><span class="co">#&gt;             </span></span>
<span><span class="co">#&gt; mvn 32429.55</span></span>
<span><span class="co">#&gt; BL  32399.25</span></span></code></pre></div>
<p>The boundary line is fitted and the parameters together with their
corresponding standard error values are obtained. However, there is one
question that needs to be addressed before we proceed,</p>
<p>Is the boundary line ideal for this data?</p>
<p>While fitting the BL model to the data, the
<em><code><a href="../reference/cbvn.html">cbvn()</a></code></em> also fits a bivariate normal model with no
boundary and calculates it <code>AIC</code> value. From our output, the
<code>AIC</code> value of the BL model is lower than that of the
bivariate normal model. Therefore, the BL model is appropriate. The
parameters of the boundary line can now be used to predict the boundary
yield given the value of P.</p>
<p>The function <code><a href="../reference/predictBL.html">predictBL()</a></code> in the BLA package can be used
for this. For more information about the function, see</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">predictBL</span></span></code></pre></div>
<p>We need to predict the largest expected yield for each point given
the soil P. We will replace any missing values with the mean value of
P.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">xp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">soil</span><span class="op">$</span><span class="va">P</span><span class="op">)</span> <span class="co"># let xp be the P content in our dataset</span></span>
<span><span class="va">xp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">xp</span><span class="op">)</span><span class="op">==</span><span class="cn">T</span><span class="op">)</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">xp</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">P</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/predictBL.html">predictBL</a></span><span class="op">(</span><span class="va">model1</span>,<span class="va">xp</span><span class="op">)</span></span></code></pre></div>
<p>We can proceed to the next variable pH using the same procedure.</p>
</div>
</div>
<div class="section level3">
<h3 id="soil-ph-boundary-line-fitting">Soil pH boundary line fitting<a class="anchor" aria-label="anchor" href="#soil-ph-boundary-line-fitting"></a>
</h3>
<div class="section level4">
<h4 id="data-exploration-1">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration-1"></a>
</h4>
<p>1. Testing for normality of independent and dependent variable</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">&lt;-</span><span class="va">soil</span><span class="op">$</span><span class="va">pH</span></span>
<span><span class="va">y</span><span class="op">&lt;-</span><span class="va">soil</span><span class="op">$</span><span class="va">yield</span></span>
<span></span>
<span><span class="co">#Distribution of the x variable</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summa.html">summa</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># Gives indices for skewness. Normal distribution range of -1 to 1. If not normally distributed,a transformation is required </span></span>
<span><span class="co">#&gt;          Mean Median Quartile.1 Quartile.3  Variance        SD  Skewness</span></span>
<span><span class="co">#&gt; [1,] 7.566133   7.74       7.12        8.1 0.4346898 0.6593101 -0.798602</span></span>
<span><span class="co">#&gt;      Octile skewness    Kurtosis No. outliers</span></span>
<span><span class="co">#&gt; [1,]      -0.3594771 -0.07176715            0</span></span>
<span><span class="fu"><a href="../reference/summaplot.html">summaplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># histogram and qqplot for distribution of x</span></span></code></pre></div>
<p><img src="cbvn_use_files/figure-html/unnamed-chunk-16-1.png" width="384" style="display: block; margin: auto;"></p>
<p>2. Removal of outliers</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> </span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> </span>
<span><span class="va">bag</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/aplpack/man/bagplot.html" class="external-link">bagplot</a></span><span class="op">(</span><span class="va">df</span>,show.whiskers <span class="op">=</span> <span class="cn">FALSE</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bag"</span>,<span class="st">"loop"</span>,<span class="st">"outliers"</span>, <span class="st">"d.median"</span><span class="op">)</span>, </span>
<span>           pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>,<span class="fl">15</span>,<span class="fl">16</span>,<span class="fl">8</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"lightblue"</span>,<span class="st">"red"</span>,<span class="st">"red"</span><span class="op">)</span>,cex<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="cbvn_use_files/figure-html/unnamed-chunk-17-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Combine data points from "bag" and within the loop</span></span>
<span></span>
<span><span class="va">dat</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">bag</span><span class="op">$</span><span class="va">pxy.bag</span>,<span class="va">bag</span><span class="op">$</span><span class="va">pxy.outer</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Output is a matrix, we can pull out x and y variables for next stage </span></span>
<span></span>
<span><span class="va">x</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> </span>
<span><span class="va">y</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p>3. Testing data for presence of boundary</p>
<p>This was already done using P and boundary existence was
confirmed</p>
</div>
<div class="section level4">
<h4 id="fitting-the-boundary-line-to-data-1">Fitting the boundary line to data<a class="anchor" aria-label="anchor" href="#fitting-the-boundary-line-to-data-1"></a>
</h4>
<p>From the exploratory tests, they indicated that the data provides
evidence of boundary existence, outliers have been identified and
removed, and the variables <em><code>x</code></em> and
<em><code>y</code></em> are normally distributed. We therefore, proceed
to fit a boundary line model to the data set using the censored
bivariate normal model. The function <em><code><a href="../reference/cbvn.html">cbvn()</a></code></em> fits
the boundary line to the data.</p>
<p>We determine the argument values for the function
<em><code><a href="../reference/cbvn.html">cbvn()</a></code></em> as before . Firstly, create a data-frame
containing <em><code>x</code></em> and <em><code>y</code>,</em> called
<code>vals</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vals</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="co">#This is an input dataframe containing the variables</span></span></code></pre></div>
<p>Secondly, the <em><code><a href="../reference/cbvn.html">cbvn()</a></code></em> requires initial starting
values, <em><code>theta</code></em>, which are parameters of the
boundary line (the censor) and the bivariate normal distribution. In
this case, we shall fit a linear+Plateau model (lp) and hence the
parameters are the plateau value and the intercept and slope of the
linear component. With a scatter plot of <em><code>y</code></em> against
<em><code>x</code></em> active in the plot window in <code>R</code>, run
the function <em><code>start.values("lp")</code></em>, then click on the
plot, the point you expect to be the lowest and the largest response of
a linear model at the boundary. Note that starting values for other
models can be determined by changing the model name from “lp” to the
desired models (see <em><code><a href="../reference/startValues.html">?startValues</a></code></em> help file)</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/startValues.html">startValues</a></span><span class="op">(</span><span class="st">"lp"</span><span class="op">)</span> </span></code></pre></div>
<p>Next, determine the parameters of the bivariate normal distribution
which include the means of the <em><code>x</code></em> and
<em><code>y</code></em> variables, standard deviation of the
<em><code>x</code></em> and <em><code>y</code></em> variables, and the
correlation of <em><code>x</code></em> and <em><code>y</code></em>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 7.569203</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 9.277917</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 0.656315</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 1.755941</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1169399</span></span>
<span></span>
<span><span class="co">#The parameters of the boundary line and the data can be combined in a #vector theta in the order </span></span>
<span><span class="co">#theta&lt;-c(intercept, slope, max response, mean(x), mean(y), sd(x), sd(y), cor(x,y))</span></span>
<span></span>
<span><span class="va">theta</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9</span>,<span class="fl">3</span>, <span class="fl">13.5</span>,<span class="fl">7.5</span>,<span class="fl">9</span>,<span class="fl">0.68</span>,<span class="fl">2.3</span>,<span class="fl">0.12</span><span class="op">)</span></span></code></pre></div>
<p>The standard deviation of the measurement error,
<em><code>sigh</code></em> was already determine as 0.7. Now that all
the arguments required for <code><a href="../reference/cbvn.html">cbvn()</a></code> function are set, the
boundary line can be fitted</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model2</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/cbvn.html">cbvn</a></span><span class="op">(</span><span class="va">vals</span>,<span class="va">theta</span>,sigh<span class="op">=</span><span class="fl">0.7</span>,model <span class="op">=</span> <span class="st">"lp"</span>, xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"pH"</span><span class="op">)</span>, ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Yield /t ha"</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">}</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">16</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: This function may take a few minutes to run for large datasets.</span></span></code></pre></div>
<p><img src="cbvn_use_files/figure-html/unnamed-chunk-21-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model2</span></span>
<span><span class="co">#&gt; $Model</span></span>
<span><span class="co">#&gt; [1] "lp"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Equation</span></span>
<span><span class="co">#&gt; [1] y = min (β₁ + β₂x, β₀)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Parameters</span></span>
<span><span class="co">#&gt;         Estimate Standard error</span></span>
<span><span class="co">#&gt; β₁    -3.9496797    0.559515105</span></span>
<span><span class="co">#&gt; β₂     2.5933722    0.095374741</span></span>
<span><span class="co">#&gt; β₀    13.2047017    0.173490948</span></span>
<span><span class="co">#&gt; mux    7.5692055    0.008439496</span></span>
<span><span class="co">#&gt; muy    9.2840069    0.022826758</span></span>
<span><span class="co">#&gt; sdx    0.6562759    0.005967791</span></span>
<span><span class="co">#&gt; sdy    1.6239674    0.018079586</span></span>
<span><span class="co">#&gt; rcorr  0.1233205    0.014184408</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $AIC</span></span>
<span><span class="co">#&gt;             </span></span>
<span><span class="co">#&gt; mvn 35962.04</span></span>
<span><span class="co">#&gt; BL  35946.16</span></span></code></pre></div>
<p>The boundary line is fitted and the parameters together with their
corresponding standard error values are obtained. From our output, the
<code>AIC</code> value of the BL model is lower than that of the
bivariate normal model. Therefore, the BL model is appropriate. The
parameters of the boundary line can now be used to predict the boundary
yield given the value of pH using the function <code><a href="../reference/predictBL.html">predictBL()</a></code>.
We need to predict the largest expected yield for each farm given the
soil pH. We will replace any missing values with the mean value of
pH.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">xpH</span><span class="op">&lt;-</span><span class="va">soil</span><span class="op">$</span><span class="va">pH</span> <span class="co"># let xpH be the P content in our dataset</span></span>
<span><span class="va">xpH</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">xpH</span><span class="op">)</span><span class="op">==</span><span class="cn">T</span><span class="op">)</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">xpH</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">pH</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/predictBL.html">predictBL</a></span><span class="op">(</span><span class="va">model2</span>,<span class="va">xpH</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="determination-of-most-limiting-factor">Determination of most limiting factor<a class="anchor" aria-label="anchor" href="#determination-of-most-limiting-factor"></a>
</h3>
<p>The boundary line analysis has been used to determine the most
limiting factor in many yield gap analysis studies. This is according to
the von Liebig (1840) law of the minimum</p>
<p><span class="math display">\[
y=min(f_1(x_1),f_2(x_2),...,f_n(x_n))
\]</span></p>
<p>In the BLA package, the function <code><a href="../reference/limfactor.html">limfactor()</a></code> can be used
to determine the most limiting factor at each point. For more
information on the function, see</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">limfactor</span></span></code></pre></div>
<p>For the two soil properties in our dataset, the most limiting factor
for each data point is determined as</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Limiting_factor</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/limfactor.html">limfactor</a></span><span class="op">(</span><span class="va">P</span>,<span class="va">pH</span><span class="op">)</span> <span class="co"># This produces a list of length 2 containg a vector limiting factors at each pont and the maximum predicted response in the dataset.</span></span>
<span></span>
<span><span class="va">Limiting_factors</span><span class="op">&lt;-</span><span class="va">Limiting_factor</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> </span></code></pre></div>
<p>We can check the proportion of cases in which each of the soil
properties was limiting</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Lim_factors</span><span class="op">&lt;-</span><span class="va">Limiting_factors</span><span class="op">$</span><span class="va">Lim_factor</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Lim_factors</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>,</span>
<span>        ylab <span class="op">=</span> <span class="st">"Percentage (%)"</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Soil property"</span>,</span>
<span>        col <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>        ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">90</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="cn">FALSE</span>, lwd <span class="op">=</span> <span class="fl">1</span>, col.ticks <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  </span></code></pre></div>
<p><img src="cbvn_use_files/figure-html/unnamed-chunk-25-1.png" width="384" style="display: block; margin: auto;"></p>
<p>As only two factors were evaluated, most of the yield gap cause was
unidentified. This is because there many other factors affecting yield
which we did not consider in this case. You can also plot the predicted
yield by the most limiting factor against the actual yield.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Limiting_factors</span><span class="op">$</span><span class="va">Rs</span>, <span class="va">soil</span><span class="op">$</span><span class="va">yield</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Predicted yield (ton/ha)"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Actual yield (ton/ha)"</span>, pch<span class="op">=</span><span class="fl">16</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="va">Limiting_factor</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, col<span class="op">=</span><span class="st">"blue"</span>, lty<span class="op">=</span><span class="fl">5</span>, lwd<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">Limiting_factors</span><span class="op">$</span><span class="va">Rs</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Limiting_factors</span><span class="op">$</span><span class="va">Rs</span><span class="op">)</span><span class="op">)</span>, </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">Limiting_factors</span><span class="op">$</span><span class="va">Rs</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Limiting_factors</span><span class="op">$</span><span class="va">Rs</span><span class="op">)</span><span class="op">)</span>, </span>
<span>col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>,legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Att yield"</span>, <span class="st">"1:1 line"</span><span class="op">)</span>,</span>
<span>       lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="cbvn_use_files/figure-html/unnamed-chunk-26-1.png" width="384" style="display: block; margin: auto;"></p>
<p>The horizontal red line represents the attainable yield for this
particular setting. The 1:1 describes the situations in which the actual
yield is equal to the predicted yield by the most limiting factor. The
yield gap for each point is equivalent to the vertical distance between
the point and the 1:1 line. The points above the 1:1 line are considered
to have zero yield gap and their position above the line is only due to
measurement error.</p>
</div>
<div class="section level3">
<h3 id="concluding-remarks">Concluding remarks<a class="anchor" aria-label="anchor" href="#concluding-remarks"></a>
</h3>
<p>The censored bivariate normal model has been used to carryout a yield
gap analysis. The advantage of using this method over the other boundary
line fitting methods is that it is based on statistical principals and
it removes the subjectivity associated with selection of bin sizes and
the quantile to consider as boundary as it is done in the binning
methodology and quantile regression. Furthermore, the uncertainty around
the boundary line can also be determined.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>1. Milne, A. E., Wheeler, H. C., &amp; Lark, R. M. (2006). On testing
biological data for the presence of a boundary. Annals of Applied
Biology, 149 , 213-222. doi:<a href="https://doi.org/10.1111/j.1744-7348.2006.00085.x" class="external-link uri">https://doi.org/10.1111/j.1744-7348.2006.00085.x</a></p>
<p>2. Lark, R. M., Gillingham, V., Langton, D., &amp; Marchant, B. P.
(2020). Boundary line models for soil nutrient concentrations and wheat
yield in national-scale datasets.European Journal of Soil Science, 71 ,
334-351. doi: <a href="https://doi.org/10.1111/" class="external-link uri">https://doi.org/10.1111/</a><a href="https://doi.org/10.1111/ejss.12891" class="external-link">ejss.12891</a></p>
<p>3. Lark, R. M., &amp; Milne, A. E. (2016). Boundary line analysis of
the effect of water filled pore space on nitrous oxide emission from
cores of arable soil. European Journal of Soil Science, 67 , 148-159.
doi: <a href="https://doi.org/10.1111/ejss.12318" class="external-link uri">https://doi.org/10.1111/ejss.12318</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Chawezi Miti, Richard M Lark, Alice E Milne, Ken E Giller, University of Nottingham/Rothamsted Research.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
